<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zobo - Your AI Friend</title>
    
    <!-- Bootstrap CSS (Replit dark theme) -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Drive Picker API -->
    <script src="https://apis.google.com/js/api.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Main Chat Area -->
            <div class="col-12 col-lg-8 offset-lg-2 d-flex flex-column h-100">
                
                <!-- Header -->
                <header class="bg-dark border-bottom p-3 mb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-robot text-info me-2 fs-4"></i>
                            <h1 class="h4 mb-0">Zobo - Your AI Friend</h1>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <!-- User info -->
                            <div class="dropdown" id="userDropdown" style="display: none;">
                                <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <img id="userAvatar" src="" alt="" class="rounded-circle me-1" style="width: 20px; height: 20px; display: none;">
                                    <span id="userName"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><span class="dropdown-item-text small text-muted" id="userEmail"></span></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i>Sign Out</a></li>
                                </ul>
                            </div>
                            
                            <button class="btn btn-outline-secondary btn-sm" id="settingsBtn" title="Settings" data-bs-toggle="modal" data-bs-target="#settingsModal">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" id="clearBtn" title="Clear conversation">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" id="wakeWordBtn" title="Toggle Hey Zobo wake word">
                                <i class="fas fa-ear-listen"></i>
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" id="voiceStatusBtn" title="Voice API status">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="btn btn-outline-info btn-sm" id="statusBtn" title="Check API status">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Status Alert -->
                <div id="statusAlert" class="alert alert-warning alert-dismissible fade show d-none" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="statusMessage"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Chat Messages Container -->
                <div class="flex-grow-1 overflow-auto" id="chatContainer">
                    <div class="container py-3">
                        <div id="messagesArea">
                            <!-- Welcome message -->
                            <div class="message-bubble assistant-message mb-3">
                                <div class="d-flex align-items-start">
                                    <div class="avatar bg-info rounded-circle me-3 d-flex align-items-center justify-content-center">
                                        <i class="fas fa-robot text-white"></i>
                                    </div>
                                    <div class="message-content">
                                        <div class="message-header mb-1">
                                            <strong>Zobo</strong>
                                            <small class="text-muted ms-2">Your AI Friend</small>
                                        </div>
                                        <div class="message-text">
                                            Hey there! I'm Zobo, your AI friend! Think of me as that buddy who's always ready to chat, help out, or just listen. Whether you want to talk about your day, work through problems together, or explore ideas - I'm here for you.<br><br>
                                            
                                            <span class="text-info"><i class="fas fa-brain me-1"></i><strong>I remember you:</strong></span> When you tell me personal details like your name, age, school, or interests, I'll remember them for our future conversations - but only for you! Your information stays private and personalized to make our chats more meaningful.<br><br>
                                            
                                            What's on your mind?
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Loading indicator -->
                        <div id="loadingIndicator" class="message-bubble assistant-message mb-3 d-none">
                            <div class="d-flex align-items-start">
                                <div class="avatar bg-info rounded-circle me-3 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-robot text-white"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-header mb-1">
                                        <strong>Zobo</strong>
                                        <small class="text-muted ms-2">Your AI Friend</small>
                                    </div>
                                    <div class="message-text">
                                        <div class="typing-indicator">
                                            <span></span>
                                            <span></span>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Message Input Area -->
                <div class="bg-dark border-top p-3">
                    <form id="chatForm" class="row g-2">
                        <div class="col">
                            <div class="input-group">
                                <button class="btn btn-outline-secondary" type="button" id="attachBtn" data-bs-toggle="dropdown" aria-expanded="false" title="Attach files">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <ul class="dropdown-menu" id="attachMenu">
                                    <li><a class="dropdown-item" href="#" id="localFileBtn"><i class="fas fa-file me-2"></i>Connect File to Zobo</a></li>
                                    <li><a class="dropdown-item" href="#" id="oneDriveBtn"><i class="fab fa-microsoft me-2"></i>OneDrive</a></li>
                                    <li><a class="dropdown-item" href="#" id="addLinkBtn"><i class="fas fa-link me-2"></i>Add Link</a></li>
                                </ul>
                                <textarea 
                                    id="messageInput" 
                                    class="form-control" 
                                    placeholder="Type your message here... (Press Ctrl+Enter to send)"
                                    rows="1"
                                    style="resize: none;"
                                    maxlength="2000"
                                ></textarea>
                                <button class="btn btn-outline-secondary" type="button" id="voiceRecordBtn" title="Record voice message">
                                    <i class="fas fa-microphone" id="voiceRecordIcon"></i>
                                </button>
                                <button class="btn btn-outline-secondary" type="button" id="voiceSpeakBtn" title="Speak last message">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <button class="btn btn-primary" type="submit" id="sendBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <!-- Hidden file input -->
                            <input type="file" id="fileInput" style="display: none;" multiple accept=".txt,.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                        </div>
                            <small class="text-muted">
                                <span id="charCount">0</span>/2000 characters
                            </small>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="settingsModalLabel">
                        <i class="fas fa-cog me-2 text-info"></i>Settings
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <!-- Account Management -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-info mb-3"><i class="fas fa-user me-2"></i>Account Management</h6>
                                <div class="card bg-secondary border-0">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <img id="settingsUserAvatar" src="" alt="" class="rounded-circle me-3" style="width: 48px; height: 48px; display: none;">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1" id="settingsUserName">Loading...</h6>
                                                <small class="text-muted" id="settingsUserEmail">Loading...</small>
                                            </div>
                                            <span class="badge bg-info" id="settingsUserProvider">Loading...</span>
                                        </div>
                                        <div class="d-grid gap-2 d-md-flex">
                                            <button class="btn btn-outline-warning btn-sm" id="switchAccountBtn">
                                                <i class="fas fa-exchange-alt me-2"></i>Switch Account
                                            </button>
                                            <button class="btn btn-outline-danger btn-sm" id="signOutBtn">
                                                <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Connected Apps -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-info mb-3"><i class="fas fa-link me-2"></i>Connected Apps & Services</h6>
                                <div class="card bg-secondary border-0">
                                    <div class="card-body">
                                        <!-- Google Calendar -->
                                        <div class="d-flex align-items-center justify-content-between mb-3 p-2 bg-dark rounded">
                                            <div class="d-flex align-items-center">
                                                <i class="fab fa-google text-danger fs-5 me-3"></i>
                                                <div>
                                                    <h6 class="mb-1">Google Calendar</h6>
                                                    <small class="text-muted">Manage your calendar events</small>
                                                </div>
                                            </div>
                                            <div>
                                                <span class="badge bg-success me-2" id="googleCalendarStatus">Connected</span>
                                                <button class="btn btn-outline-secondary btn-sm" id="manageGoogleCalendar">
                                                    <i class="fas fa-cog"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Microsoft 365 -->
                                        <div class="d-flex align-items-center justify-content-between mb-3 p-2 bg-dark rounded">
                                            <div class="d-flex align-items-center">
                                                <i class="fab fa-microsoft text-primary fs-5 me-3"></i>
                                                <div>
                                                    <h6 class="mb-1">Microsoft 365</h6>
                                                    <small class="text-muted">Access Outlook, OneDrive & more</small>
                                                </div>
                                            </div>
                                            <div>
                                                <span class="badge bg-secondary me-2" id="microsoftStatus">Not Connected</span>
                                                <button class="btn btn-outline-primary btn-sm" id="connectMicrosoft">
                                                    <i class="fas fa-plus"></i> Connect
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Apple iCloud -->
                                        <div class="d-flex align-items-center justify-content-between mb-3 p-2 bg-dark rounded">
                                            <div class="d-flex align-items-center">
                                                <i class="fab fa-apple text-white fs-5 me-3"></i>
                                                <div>
                                                    <h6 class="mb-1">Apple iCloud</h6>
                                                    <small class="text-muted">Connect your Apple services</small>
                                                </div>
                                            </div>
                                            <div>
                                                <span class="badge bg-secondary me-2" id="appleStatus">Not Connected</span>
                                                <button class="btn btn-outline-light btn-sm" id="connectApple">
                                                    <i class="fas fa-plus"></i> Connect
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Appearance -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-info mb-3"><i class="fas fa-palette me-2"></i>Appearance</h6>
                                <div class="card bg-secondary border-0">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="themeSelect" class="form-label">Color Theme</label>
                                                <select class="form-select bg-dark border-secondary text-white" id="themeSelect">
                                                    <option value="dark">Dark Theme (Default)</option>
                                                    <option value="light">Light Theme</option>
                                                    <option value="auto">Auto (System)</option>
                                                    <option value="blue">Blue Theme</option>
                                                    <option value="purple">Purple Theme</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fontSizeSelect" class="form-label">Font Size</label>
                                                <select class="form-select bg-dark border-secondary text-white" id="fontSizeSelect">
                                                    <option value="small">Small</option>
                                                    <option value="medium" selected>Medium</option>
                                                    <option value="large">Large</option>
                                                    <option value="extra-large">Extra Large</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="compactModeToggle">
                                                    <label class="form-check-label" for="compactModeToggle">
                                                        Compact Mode
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- User Profile -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-info mb-3"><i class="fas fa-user me-2"></i>Your Profile</h6>
                                <div class="card bg-secondary border-0">
                                    <div class="card-body">
                                        <p class="small text-muted mb-3">This information helps Zobo remember personal details about you for better conversations.</p>
                                        
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="profileName" class="form-label small">Name</label>
                                                <input type="text" class="form-control form-control-sm bg-dark border-secondary text-white" id="profileName" placeholder="Your name">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="profileAge" class="form-label small">Age</label>
                                                <input type="number" class="form-control form-control-sm bg-dark border-secondary text-white" id="profileAge" placeholder="Your age" min="5" max="100">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="profileSchool" class="form-label small">School/Work</label>
                                                <input type="text" class="form-control form-control-sm bg-dark border-secondary text-white" id="profileSchool" placeholder="School or workplace">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="profileGrade" class="form-label small">Grade/Level</label>
                                                <input type="text" class="form-control form-control-sm bg-dark border-secondary text-white" id="profileGrade" placeholder="Grade or level">
                                            </div>
                                        </div>
                                        
                                        <div class="row mt-3">
                                            <div class="col-12">
                                                <button type="button" class="btn btn-success btn-sm me-2" id="saveProfileBtn">
                                                    <i class="fas fa-save"></i> Save Profile
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="loadProfileBtn">
                                                    <i class="fas fa-sync"></i> Refresh
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-3">
                                            <div id="profileStatus" class="small text-muted"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Privacy & Data -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-info mb-3"><i class="fas fa-shield-alt me-2"></i>Privacy & Data</h6>
                                <div class="card bg-secondary border-0">
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="saveConversationsToggle" checked>
                                            <label class="form-check-label" for="saveConversationsToggle">
                                                Save conversation history
                                            </label>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="shareDataToggle">
                                            <label class="form-check-label" for="shareDataToggle">
                                                Share usage data to improve Zobo
                                            </label>
                                        </div>
                                        <div class="d-grid gap-2 d-md-flex mt-3">
                                            <button class="btn btn-outline-warning btn-sm" id="clearAllDataBtn">
                                                <i class="fas fa-trash me-2"></i>Clear All Data
                                            </button>
                                            <button class="btn btn-outline-info btn-sm" id="exportDataBtn">
                                                <i class="fas fa-download me-2"></i>Export My Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>
</html>
